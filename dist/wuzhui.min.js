"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},wuzhui;!function(wuzhui){var CONTROL_DATA_NAME="Control",Control=function(){function Control(element){if(_classCallCheck(this,Control),!element)throw wuzhui.Errors.argumentNull("element");this._element=element,wuzhui.ElementHelper.data(element,CONTROL_DATA_NAME,this)}return _createClass(Control,[{key:"appendChild",value:function(child,index){if(null==child)throw wuzhui.Errors.argumentNull("child");var childElement=void 0;childElement=child instanceof Control?child.element:child;var placeChild=void 0;null!=index&&(placeChild=this.element.children[index]),null==placeChild?this.element.appendChild(childElement):this.element.insertBefore(childElement,placeChild)}},{key:"style",value:function(value){wuzhui.applyStyle(this.element,value)}},{key:"visible",get:function(){return wuzhui.ElementHelper.isVisible(this._element)},set:function(value){value?wuzhui.ElementHelper.showElement(this._element):wuzhui.ElementHelper.hideElement(this._element)}},{key:"element",get:function(){return this._element}}],[{key:"getControlByElement",value:function(element){return wuzhui.ElementHelper.data(element,CONTROL_DATA_NAME)}}]),Control}();wuzhui.Control=Control}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var DataSource=function(){function DataSource(args){_classCallCheck(this,DataSource),this.inserting=wuzhui.callbacks1(),this.inserted=wuzhui.callbacks1(),this.deleting=wuzhui.callbacks(),this.deleted=wuzhui.callbacks(),this.updating=wuzhui.callbacks(),this.updated=wuzhui.callbacks(),this.selecting=wuzhui.callbacks(),this.selected=wuzhui.callbacks(),this.error=wuzhui.callbacks(),this.args=args,this.primaryKeys=args.primaryKeys||[]}return _createClass(DataSource,[{key:"executeInsert",value:function(item,args){return this.args.insert(item,args)}},{key:"executeDelete",value:function(item,args){return this.args["delete"](item,args)}},{key:"executeUpdate",value:function(item,args){return this.args.update(item,args)}},{key:"executeSelect",value:function(args){return this.args.select(args)}},{key:"insert",value:function(item,args,index){var _this=this;if(!this.canInsert)throw wuzhui.Errors.dataSourceCanntInsert();if(!item)throw wuzhui.Errors.argumentNull("item");return"number"==typeof args&&(index=args,args=null),this.inserting.fire(this,item,index),this.executeInsert(item,args).then(function(data){return Object.assign(item,data),_this.inserted.fire(_this,item,index),data})["catch"](function(exc){throw _this.processError(exc,"insert"),exc})}},{key:"delete",value:function(item,args){var _this2=this;if(!this.canDelete)throw wuzhui.Errors.dataSourceCanntDelete();if(!item)throw wuzhui.Errors.argumentNull("item");return this.checkPrimaryKeys(item),this.deleting.fire(this,item),this.executeDelete(item,args).then(function(data){return _this2.deleted.fire(_this2,item),data})["catch"](function(exc){throw _this2.processError(exc,"delete"),exc})}},{key:"update",value:function(item,args){var _this3=this;if(!this.canUpdate)throw wuzhui.Errors.dataSourceCanntUpdate();if(!item)throw wuzhui.Errors.argumentNull("item");return this.checkPrimaryKeys(item),this.updating.fire(this,item),this.executeUpdate(item,args).then(function(data){return Object.assign(item,data),_this3.updated.fire(_this3,item),data})["catch"](function(exc){throw _this3.processError(exc,"update"),exc})}},{key:"isSameItem",value:function(theItem,otherItem){if(null==theItem)throw wuzhui.Errors.argumentNull("theItem");if(null==otherItem)throw wuzhui.Errors.argumentNull("otherItem");if(0==this.primaryKeys.length)return theItem==otherItem;this.checkPrimaryKeys(theItem),this.checkPrimaryKeys(otherItem);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.primaryKeys[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var pk=_step.value;if(theItem[pk]!=otherItem[pk])return!1}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return!0}},{key:"checkPrimaryKeys",value:function(item){for(var key in item)if(null==item[key]&&this.primaryKeys.indexOf(key)>=0)throw wuzhui.Errors.primaryKeyNull(key)}},{key:"select",value:function(args){var _this4=this;return console.assert(null!=args),wuzhui.fireCallback(this.selecting,this,args),this.executeSelect(args).then(function(data){var dataItems=void 0,totalRowCount=void 0;if(Array.isArray(data))dataItems=data,totalRowCount=data.length;else{if(void 0===data.dataItems||void 0===data.totalRowCount)throw wuzhui.Errors.queryResultTypeError();dataItems=data.dataItems,totalRowCount=data.totalRowCount}return _this4.selected.fire(_this4,{totalRowCount:totalRowCount,dataItems:dataItems}),{totalRowCount:totalRowCount,dataItems:dataItems}})["catch"](function(exc){throw _this4.processError(exc,"select"),exc})}},{key:"processError",value:function(exc,method){if(exc.method=method,this.error.fire(this,exc),!exc.handled)throw exc}},{key:"canDelete",get:function(){return null!=this.args["delete"]&&this.primaryKeys.length>0}},{key:"canInsert",get:function(){return null!=this.args.insert&&this.primaryKeys.length>0}},{key:"canUpdate",get:function(){return null!=this.args.update&&this.primaryKeys.length>0}}]),DataSource}();wuzhui.DataSource=DataSource;var DataSourceSelectArguments=function DataSourceSelectArguments(){_classCallCheck(this,DataSourceSelectArguments),this.startRowIndex=0,this.maximumRows=2147483647};wuzhui.DataSourceSelectArguments=DataSourceSelectArguments;var ArrayDataSource=function(_DataSource){function ArrayDataSource(items){return _classCallCheck(this,ArrayDataSource),_possibleConstructorReturn(this,(ArrayDataSource.__proto__||Object.getPrototypeOf(ArrayDataSource)).call(this,{select:function(args){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function _callee(){var dataItems,result;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return args.sortExpression,dataItems=items.slice(args.startRowIndex,args.startRowIndex+args.maximumRows),result={dataItems:dataItems,totalRowCount:items.length},_context.abrupt("return",result);case 4:case"end":return _context.stop()}},_callee,this)}))}}))}return _inherits(ArrayDataSource,_DataSource),ArrayDataSource}(DataSource);wuzhui.ArrayDataSource=ArrayDataSource}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var Errors=function(){function Errors(parameters){_classCallCheck(this,Errors)}return _createClass(Errors,null,[{key:"notImplemented",value:function(message){return message=message||"Not implemented",new Error(message)}},{key:"argumentNull",value:function(paramName){return new Error("Argument '"+paramName+"' can not be null.")}},{key:"controllBelonsAnother",value:function(){return new Error("The control is belongs another control.")}},{key:"columnsCanntEmpty",value:function(){return new Error("Columns cannt empty.")}},{key:"dataSourceCanntInsert",value:function(){return new Error("DataSource can not insert.")}},{key:"dataSourceCanntUpdate",value:function(){return new Error("DataSource can not update.")}},{key:"dataSourceCanntDelete",value:function(){return new Error("DataSource can not delete.")}},{key:"primaryKeyNull",value:function(key){var msg="Primary key named '"+key+"' value is null.";return new Error(msg)}},{key:"queryResultTypeError",value:function(){var msg="Type of the query result is expected as Array or DataSourceSelectResult.";return new Error(msg)}}]),Errors}();wuzhui.Errors=Errors}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){function findParentElement(element,parentTagName){console.assert(null!=element),console.assert(null!=parentTagName),parentTagName=parentTagName.toUpperCase();for(var p=element.parentElement;p;){if(p.tagName==parentTagName)return p;p=p.parentElement}}var GridViewRowType=void 0;!function(GridViewRowType){GridViewRowType[GridViewRowType.Header=0]="Header",GridViewRowType[GridViewRowType.Footer=1]="Footer",GridViewRowType[GridViewRowType.Data=2]="Data",GridViewRowType[GridViewRowType.Paging=3]="Paging",GridViewRowType[GridViewRowType.Empty=4]="Empty"}(GridViewRowType=wuzhui.GridViewRowType||(wuzhui.GridViewRowType={}));var GridViewRow=function(_wuzhui$Control){function GridViewRow(rowType){_classCallCheck(this,GridViewRow);var element=document.createElement("tr"),_this6=_possibleConstructorReturn(this,(GridViewRow.__proto__||Object.getPrototypeOf(GridViewRow)).call(this,element));return _this6._rowType=rowType,_this6}return _inherits(GridViewRow,_wuzhui$Control),_createClass(GridViewRow,[{key:"rowType",get:function(){return this._rowType}},{key:"gridView",get:function(){if(null==this._gridView){var gridViewElement=findParentElement(this.element,"table");console.assert(null!=gridViewElement),this._gridView=wuzhui.Control.getControlByElement(gridViewElement),console.assert(null!=this._gridView)}return this._gridView}},{key:"cells",get:function(){for(var cells=new Array,i=0;i<this.element.cells.length;i++){var cell=wuzhui.Control.getControlByElement(this.element.cells[i]);console.assert(null!=cell),cells[i]=cell}return cells}}]),GridViewRow}(wuzhui.Control);wuzhui.GridViewRow=GridViewRow;var GridViewDataRow=function(_GridViewRow){function GridViewDataRow(gridView,dataItem){_classCallCheck(this,GridViewDataRow);var _this7=_possibleConstructorReturn(this,(GridViewDataRow.__proto__||Object.getPrototypeOf(GridViewDataRow)).call(this,GridViewRowType.Data));_this7._dataItem=dataItem;for(var i=0;i<gridView.columns.length;i++){var column=gridView.columns[i],cell=column.createItemCell(dataItem);cell.visible=column.visible,_this7.appendChild(cell)}return _this7}return _inherits(GridViewDataRow,_GridViewRow),_createClass(GridViewDataRow,[{key:"dataItem",get:function(){return this._dataItem}}]),GridViewDataRow}(GridViewRow);wuzhui.GridViewDataRow=GridViewDataRow;var GridView=function(_wuzhui$Control2){function GridView(params){_classCallCheck(this,GridView);var _this8=_possibleConstructorReturn(this,(GridView.__proto__||Object.getPrototypeOf(GridView)).call(this,params.element||document.createElement("table")));if(_this8.emptyDataHTML="暂无记录",_this8.initDataHTML="数据正在加载中...",_this8.loadFailHTML="加载数据失败，点击重新加载。",_this8.rowCreated=wuzhui.callbacks(),params=Object.assign({showHeader:!0,showFooter:!1,allowPaging:!1},params),_this8._params=params,_this8._columns=params.columns||[],0==_this8._columns.length)throw wuzhui.Errors.columnsCanntEmpty();for(var i=0;i<_this8._columns.length;i++){var column=_this8._columns[i];column.gridView=_this8}_this8._dataSource=params.dataSource,_this8._dataSource.selected.add(function(sender,e){return _this8.on_selectExecuted(e.dataItems)}),_this8._dataSource.updated.add(function(sender,item){return _this8.on_updateExecuted(item)}),_this8._dataSource.inserted.add(function(sender,item,index){return _this8.on_insertExecuted(item,index)}),_this8._dataSource.deleted.add(function(sender,item){return _this8.on_deleteExecuted(item)}),_this8._dataSource.selecting.add(function(sender,e){var display=_this8._emtpyRow.element.style.display;"none"!=display&&(_this8._emtpyRow.element.cells[0].innerHTML=_this8.initDataHTML)}),_this8._dataSource.error.add(function(sender,e){if("select"==e.method){_this8.on_selectExecuted([]);var element=_this8._emtpyRow.cells[0].element;element.innerHTML=_this8.loadFailHTML,element.onclick=function(){_this8._dataSource.select(_this8.selectArguments)},e.handled=!0,console.error(e.message),console.log(e.stack)}}),params.showHeader&&(_this8._header=new wuzhui.Control(document.createElement("thead")),_this8.appendChild(_this8._header),_this8.appendHeaderRow()),_this8.emptyDataHTML=params.emptyDataHTML||_this8.emptyDataHTML,_this8.initDataHTML=params.initDataHTML||_this8.initDataHTML,_this8._body=new wuzhui.Control(document.createElement("tbody")),_this8.appendChild(_this8._body),_this8.appendEmptyRow();var allowPaging=params.pageSize;return(params.showFooter||allowPaging)&&(_this8._footer=new wuzhui.Control(document.createElement("tfoot")),_this8.appendChild(_this8._footer),params.showFooter&&_this8.appendFooterRow(),allowPaging&&(_this8.createPagingBar(params.pagerSettings),_this8.pagingBar.selectArguments.maximumRows=params.pageSize)),_this8.selectArguments=_this8.pagingBar?_this8.pagingBar.selectArguments:new wuzhui.DataSourceSelectArguments,_this8.dataSource.select(_this8.selectArguments),_this8}return _inherits(GridView,_wuzhui$Control2),_createClass(GridView,[{key:"createPagingBar",value:function(pagerSettings){var pagingBarContainer=document.createElement("tr"),pagingBarElement=document.createElement("td");pagingBarElement.className=GridView.pagingBarClassName,pagingBarElement.colSpan=this.columns.length,pagingBarContainer.appendChild(pagingBarElement),console.assert(null!=this._footer),this._footer.appendChild(pagingBarContainer),this.pagingBar=new wuzhui.NumberPagingBar({dataSource:this.dataSource,element:pagingBarElement,pagerSettings:pagerSettings})}},{key:"appendEmptyRow",value:function(){this._emtpyRow=new GridViewRow(GridViewRowType.Empty),this._emtpyRow.element.className=GridView.emptyRowClassName;var cell=new wuzhui.GridViewCell;cell.element.colSpan=this.columns.length,this._params.emptyDataRowStyle||wuzhui.applyStyle(cell.element,this._params.emptyDataRowStyle),this._emtpyRow.appendChild(cell),this._body.appendChild(this._emtpyRow),wuzhui.fireCallback(this.rowCreated,this,{row:this._emtpyRow})}},{key:"appendDataRow",value:function(dataItem,index){var row=new GridViewDataRow(this,dataItem);row.element.className=GridView.dataRowClassName,this._body.appendChild(row,index);for(var cells=row.cells,j=0;j<cells.length;j++){var cell=cells[j];cell instanceof wuzhui.GridViewDataCell&&cell.render(dataItem)}return wuzhui.fireCallback(this.rowCreated,this,{row:row}),"none"!=this._emtpyRow.element.style.display&&this.hideEmptyRow(),row}},{key:"on_sort",value:function(sender,args){null!=this._currentSortCell&&this._currentSortCell!=sender&&this._currentSortCell.clearSortIcon(),this._currentSortCell=sender}},{key:"appendHeaderRow",value:function(){for(var _this9=this,row=new GridViewRow(GridViewRowType.Header),i=0;i<this.columns.length;i++){var column=this.columns[i],cell=column.createHeaderCell();cell instanceof wuzhui.GridViewHeaderCell&&cell.sorting.add(function(e,a){return _this9.on_sort(e,a)}),row.appendChild(cell),cell.visible=this.columns[i].visible}this._header.appendChild(row)}},{key:"appendFooterRow",value:function(){for(var row=new GridViewRow(GridViewRowType.Footer),i=0;i<this.columns.length;i++){var column=this.columns[i],cell=column.createFooterCell();row.appendChild(cell),cell.visible=column.visible}this._footer.appendChild(row)}},{key:"on_selectExecuted",value:function(items){for(var rows=this._body.element.querySelectorAll("."+GridView.dataRowClassName),i=0;i<rows.length;i++)this._body.element.removeChild(rows[i]);if(0==items.length)return void this.showEmptyRow();for(var _i=0;_i<items.length;_i++)this.appendDataRow(items[_i])}},{key:"on_updateExecuted",value:function(item){console.assert(null!=item);for(var i=0;i<this._body.element.rows.length;i++){var row_element=this._body.element.rows[i],row=wuzhui.Control.getControlByElement(row_element);if(row instanceof GridViewDataRow){var dataItem=row.dataItem;if(this.dataSource.isSameItem(dataItem,item)){dataItem!=item&&Object.assign(dataItem,item);for(var cells=row.cells,j=0;j<cells.length;j++){var cell=cells[j];cell instanceof wuzhui.GridViewDataCell&&cell.render(dataItem)}break}}}}},{key:"on_insertExecuted",value:function(item,index){null==index&&(index=0),this.appendDataRow(item,index)}},{key:"on_deleteExecuted",value:function(item){for(var rows=this._body.element.rows,dataRows=new Array,i=0;i<rows.length;i++){var row=wuzhui.Control.getControlByElement(rows.item(i));row instanceof GridViewDataRow&&dataRows.push(row)}for(var _i2=0;_i2<dataRows.length;_i2++){var dataRow=dataRows[_i2];this.dataSource.isSameItem(item,dataRow.dataItem)&&(dataRow.element.remove(),1==dataRows.length&&this.showEmptyRow())}}},{key:"showEmptyRow",value:function(){this._emtpyRow.element.cells[0].innerHTML=this.emptyDataHTML,this._emtpyRow.element.style.removeProperty("display")}},{key:"hideEmptyRow",value:function(){this._emtpyRow.element.style.display="none"}},{key:"columns",get:function(){return this._columns}},{key:"dataSource",get:function(){return this._dataSource}}]),GridView}(wuzhui.Control);GridView.emptyRowClassName="empty",GridView.dataRowClassName="data",GridView.pagingBarClassName="pagingBar",wuzhui.GridView=GridView}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var PagerPosition=void 0;!function(PagerPosition){PagerPosition[PagerPosition.Bottom=0]="Bottom",PagerPosition[PagerPosition.Top=1]="Top",PagerPosition[PagerPosition.TopAndBottom=2]="TopAndBottom"}(PagerPosition=wuzhui.PagerPosition||(wuzhui.PagerPosition={}));var PagingBar=function(){function PagingBar(){_classCallCheck(this,PagingBar)}return _createClass(PagingBar,[{key:"init",value:function(dataSource,selectArguments){var _this10=this;if(null==dataSource)throw wuzhui.Errors.argumentNull("dataSource");this._pageIndex=0,this._selectArguments=selectArguments||new wuzhui.DataSourceSelectArguments;var pagingBar=this;pagingBar.totalRowCount=1e6,dataSource.selected.add(function(source,args){pagingBar._pageSize=_this10._selectArguments.maximumRows;var totalRowCount=args.totalRowCount;null!=totalRowCount&&totalRowCount>=0&&(pagingBar.totalRowCount=totalRowCount);var startRowIndex=_this10._selectArguments.startRowIndex;(null==startRowIndex||startRowIndex<=0)&&(startRowIndex=0),pagingBar._pageIndex=Math.floor(startRowIndex/pagingBar._pageSize),pagingBar.render()}),dataSource.deleted.add(function(){pagingBar.totalRowCount=pagingBar.totalRowCount-1,pagingBar.render()}),dataSource.inserted.add(function(){pagingBar.totalRowCount=pagingBar.totalRowCount+1,pagingBar.render()})}},{key:"render",value:function(){throw wuzhui.Errors.notImplemented("The table-row render method is not implemented.")}},{key:"selectArguments",get:function(){return this._selectArguments}},{key:"pageCount",get:function(){var pageCount=Math.ceil(this.totalRowCount/this.pageSize);return pageCount}},{key:"pageSize",get:function(){return this._pageSize},set:function(value){this._pageSize=value}},{key:"pageIndex",get:function(){return this._pageIndex},set:function(value){this._pageIndex=value}},{key:"totalRowCount",get:function(){return this._totalRowCount},set:function(value){this._totalRowCount=value}}]),PagingBar}();wuzhui.PagingBar=PagingBar;var NumberPagingBar=function(_PagingBar){function NumberPagingBar(params){if(_classCallCheck(this,NumberPagingBar),!params.dataSource)throw wuzhui.Errors.argumentNull("dataSource");if(!params.element)throw wuzhui.Errors.argumentNull("element");var pagerSettings=Object.assign({pageButtonCount:10,firstPageText:"<<",lastPageText:">>",nextPageText:"...",previousPageText:"...",showTotal:!0},params.pagerSettings||{}),_this11=_possibleConstructorReturn(this,(NumberPagingBar.__proto__||Object.getPrototypeOf(NumberPagingBar)).call(this));_this11.dataSource=params.dataSource,_this11.pagerSettings=pagerSettings,_this11.element=params.element,_this11.numberButtons=new Array,_this11.createButton=_this11.createPagingButton,_this11.createLabel=_this11.createTotalLabel;var buttonContainer=pagerSettings.buttonContainerWraper?document.createElement(pagerSettings.buttonContainerWraper):document.createElement("div");return buttonContainer.className=pagerSettings.buttonContainerClassName||"buttons",_this11.element.appendChild(buttonContainer),_this11.createPreviousButtons(buttonContainer),_this11.createNumberButtons(buttonContainer),_this11.createNextButtons(buttonContainer),_this11.pagerSettings.showTotal&&(_this11.totalElement=_this11.createLabel(),_this11.totalElement.visible=!1),_this11.init(params.dataSource,params.selectArguments),_this11}return _inherits(NumberPagingBar,_PagingBar),_createClass(NumberPagingBar,[{key:"createPagingButton",value:function(container){var _this12=this,pagerSettings=this.pagerSettings,button=document.createElement("a");if(button.href="javascript:",this.pagerSettings.buttonWrapper){var w=document.createElement(this.pagerSettings.buttonWrapper);w.appendChild(button),container.appendChild(w)}else container.appendChild(button);var result={_button:button,get visible(){var button=this._button;return"none"!=button.style.display},set visible(value){var button=this._button,element=pagerSettings.buttonWrapper?button.parentElement:button;value?element.style.removeProperty("display"):element.style.display="none"},get pageIndex(){var button=this._button;return new Number(button.getAttribute("pageIndex")).valueOf()},set pageIndex(value){var button=this._button;button.setAttribute("pageIndex",value)},get text(){var button=this._button;return button.innerHTML},set text(value){var button=this._button;button.innerHTML=value},get active(){var button=this._button;return null!=button.href},set active(value){var button=this._button;return 1==value?(button.removeAttribute("href"),void(pagerSettings.activeButtonClassName&&this.setClassName(pagerSettings.activeButtonClassName))):(button.href="javascript:",void(pagerSettings.buttonClassName?this.setClassName(pagerSettings.buttonClassName):this.setClassName(null)))},setClassName:function(value){var button=this._button,element=pagerSettings.buttonWrapper?button.parentElement:button;value?element.className=value:element.removeAttribute("class")},onclick:null};return button.onclick=function(){result.onclick&&result.onclick(result,_this12)},result}},{key:"createTotalLabel",value:function(){var totalElement=document.createElement("div");totalElement.className="total";var textElement=document.createElement("span");textElement.className="text",textElement.innerHTML="总记录：",totalElement.appendChild(textElement);var numberElement=document.createElement("span");return numberElement.className="number",totalElement.appendChild(numberElement),this.element.appendChild(totalElement),{get text(){return numberElement.innerHTML},set text(value){numberElement.innerHTML=value},get visible(){var display=totalElement.style.display;return"none"!=display},set visible(value){1==value?totalElement.style.display="block":totalElement.style.display="node"}}}},{key:"createPreviousButtons",value:function(buttonContainer){this.firstPageButton=this.createButton(buttonContainer),this.firstPageButton.onclick=NumberPagingBar.on_buttonClick,this.firstPageButton.text=this.pagerSettings.firstPageText,this.firstPageButton.visible=!1,this.previousPageButton=this.createButton(buttonContainer),this.previousPageButton.onclick=NumberPagingBar.on_buttonClick,this.previousPageButton.text=this.pagerSettings.previousPageText,this.previousPageButton.visible=!1}},{key:"createNextButtons",value:function(buttonContainer){this.nextPageButton=this.createButton(buttonContainer),this.nextPageButton.onclick=NumberPagingBar.on_buttonClick,this.nextPageButton.text=this.pagerSettings.nextPageText,this.nextPageButton.visible=!1,this.lastPageButton=this.createButton(buttonContainer),this.lastPageButton.onclick=NumberPagingBar.on_buttonClick,this.lastPageButton.text=this.pagerSettings.lastPageText,this.lastPageButton.visible=!1}},{key:"createNumberButtons",value:function(buttonContainer){for(var pagingBar=this,buttonCount=this.pagerSettings.pageButtonCount,i=0;i<buttonCount;i++){var button=this.createButton(buttonContainer);button.onclick=NumberPagingBar.on_buttonClick,this.numberButtons[i]=button}this.numberButtons.forEach(function(btn){btn.onclick=function(){return NumberPagingBar.on_buttonClick(btn,pagingBar)}})}},{key:"render",value:function(){var pagerSettings=this.pagerSettings,buttonCount=pagerSettings.pageButtonCount,pagingBarIndex=Math.floor(this.pageIndex/buttonCount),pagingBarCount=Math.ceil(this.pageCount/buttonCount);this.previousPageButton.pageIndex=(pagingBarIndex-1)*buttonCount,this.nextPageButton.pageIndex=(pagingBarIndex+1)*buttonCount,this.firstPageButton.pageIndex=0,this.lastPageButton.pageIndex=this.pageCount-1;for(var i=0;i<this.numberButtons.length;i++){var pageIndex=pagingBarIndex*buttonCount+i;pageIndex<this.pageCount?(this.numberButtons[i].pageIndex=pageIndex,this.numberButtons[i].text=(pagingBarIndex*buttonCount+i+1).toString(),this.numberButtons[i].visible=!0,this.numberButtons[i].active=pageIndex==this.pageIndex):this.numberButtons[i].visible=!1}this.totalElement&&(this.totalElement.text=this.totalRowCount,this.totalElement.visible=!0),this.firstPageButton.visible=!1,this.previousPageButton.visible=!1,this.lastPageButton.visible=!1,this.nextPageButton.visible=!1,pagingBarIndex>0&&(this.firstPageButton.visible=!0,this.previousPageButton.visible=!0),pagingBarIndex<pagingBarCount-1&&(this.lastPageButton.visible=!0,this.nextPageButton.visible=!0)}}],[{key:"on_buttonClick",value:function(button,pagingBar){var pageIndex=button.pageIndex;if(null!=!pageIndex){var args=pagingBar.selectArguments;args.maximumRows=pagingBar.pageSize,args.startRowIndex=pageIndex*pagingBar.pageSize,pagingBar.pageIndex=pageIndex,pagingBar.dataSource.select(pagingBar.selectArguments)}}}]),NumberPagingBar}(PagingBar);wuzhui.NumberPagingBar=NumberPagingBar}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){function applyStyle(element,value){var style=value||"";if("string"==typeof style)element.setAttribute("style",style);else for(var key in style)element.style[key]=style[key]}function callbacks(){return new Callback}function callbacks1(){return new Callback}function fireCallback(callback){for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)args[_key2-1]=arguments[_key2];callback.fire.apply(callback,args)}var ElementHelper=function(){function ElementHelper(){_classCallCheck(this,ElementHelper)}return _createClass(ElementHelper,null,[{key:"showElement",value:function(element){if(!element)throw wuzhui.Errors.argumentNull("element");element.style.removeProperty("display")}},{key:"hideElement",value:function(element){if(!element)throw wuzhui.Errors.argumentNull("element");element.style.display="none"}},{key:"isVisible",value:function(element){var display=element.style.display;return!display||"none"!=display}},{key:"data",value:function(element,name,value){return element.data=element.data||{},null==value?element.data.name:void(element.data.name=value)}},{key:"findFirstParentByTagName",value:function(element,tagName){if(null==element)throw wuzhui.Errors.argumentNull("element");if(!tagName)throw wuzhui.Errors.argumentNull("tagName");for(var parent=element.parentElement;null!=parent;){if(parent.tagName.toLowerCase()==tagName.toLowerCase())return parent;parent=parent.parentElement}return null}}]),ElementHelper}();wuzhui.ElementHelper=ElementHelper,wuzhui.applyStyle=applyStyle;var Callback=function(){function Callback(){_classCallCheck(this,Callback),this.funcs=new Array}return _createClass(Callback,[{key:"add",value:function(func){this.funcs.push(func)}},{key:"remove",value:function(func){this.funcs=this.funcs.filter(function(o){return o!=func})}},{key:"fire",value:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];this.funcs.forEach(function(o){return o.apply(void 0,args)})}}]),Callback}();wuzhui.Callback=Callback,wuzhui.callbacks=callbacks,wuzhui.callbacks1=callbacks1,wuzhui.fireCallback=fireCallback}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var GridViewCell=function(_wuzhui$Control3){function GridViewCell(){return _classCallCheck(this,GridViewCell),_possibleConstructorReturn(this,(GridViewCell.__proto__||Object.getPrototypeOf(GridViewCell)).call(this,document.createElement("td")))}return _inherits(GridViewCell,_wuzhui$Control3),GridViewCell}(wuzhui.Control);wuzhui.GridViewCell=GridViewCell;var GridViewDataCell=function(_GridViewCell){function GridViewDataCell(params){_classCallCheck(this,GridViewDataCell);var _this14=_possibleConstructorReturn(this,(GridViewDataCell.__proto__||Object.getPrototypeOf(GridViewDataCell)).call(this)),p=params;return _this14.nullText=null!=p.nullText?p.nullText:"",_this14.dataFormatString=p.dataFormatString,_this14.dataField=p.dataField,p.render&&(_this14.render=function(dataItem){return p.render.apply(_this14,[dataItem,_this14.element])}),_this14}return _inherits(GridViewDataCell,_GridViewCell),_createClass(GridViewDataCell,[{key:"render",value:function(dataItem){var text,value=dataItem[this.dataField];text=null==value?this.nullText:this.dataFormatString?this.formatValue(this.dataFormatString,value):""+value,this.element.innerHTML=text}},{key:"formatValue",value:function(format,arg){for(var result="",i=0;;){var open=format.indexOf("{",i),close=format.indexOf("}",i);if(open<0&&close<0){result+=format.slice(i);break}if(close>0&&(close<open||open<0)){if("}"!==format.charAt(close+1))throw new Error("Sys.Res.stringFormatBraceMismatch");result+=format.slice(i,close+1),i=close+2}else if(result+=format.slice(i,open),i=open+1,"{"!==format.charAt(i)){if(close<0)throw new Error("Sys.Res.stringFormatBraceMismatch");var brace=format.substring(i,close),argFormat=brace;"undefined"!=typeof arg&&null!==arg||(arg=""),result+=arg instanceof Date?this.formatDate(arg,argFormat):arg instanceof Number||"number"==typeof arg?this.formatNumber(arg,argFormat):arg.toString(),i=close+1}else result+="{",i++}return result}},{key:"formatDate",value:function(value,format){var y=value.getFullYear(),m=value.getMonth()+1,d=value.getDate(),h=value.getHours(),M=value.getMinutes(),s=value.getSeconds(),twoDigit=function(value){var TEN=10;return value<TEN?"0"+value:value.toString()};switch(format){case"d":return y+"-"+m+"-"+d;case"g":return y+"-"+m+"-"+d+" "+h+":"+M;
case"gg":return y+"-"+twoDigit(m)+"-"+twoDigit(d)+" "+twoDigit(h)+":"+twoDigit(M);case"G":return y+"-"+m+"-"+d+" "+h+":"+M+":"+s;case"GG":return y+"-"+twoDigit(m)+"-"+twoDigit(d)+" "+twoDigit(h)+":"+twoDigit(M)+":"+twoDigit(s);case"t":return h+":"+M;case"T":return h+":"+M+":"+s}return value.toString()}},{key:"formatNumber",value:function(value,format){var reg=new RegExp("^C[0-9]+");if(reg.test(format)){var num=format.substr(1);return value.toFixed(num)}return value.toString()}}]),GridViewDataCell}(GridViewCell);wuzhui.GridViewDataCell=GridViewDataCell;var GridViewHeaderCell=function(_wuzhui$Control4){function GridViewHeaderCell(field){_classCallCheck(this,GridViewHeaderCell);var _this15=_possibleConstructorReturn(this,(GridViewHeaderCell.__proto__||Object.getPrototypeOf(GridViewHeaderCell)).call(this,document.createElement("th")));if(_this15.ascHTML="↑",_this15.descHTML="↓",_this15.sortingHTML="...",_this15.field=field,_this15.sorting=wuzhui.callbacks(),_this15.sorted=wuzhui.callbacks(),field.sortExpression){var labelElement=document.createElement("a");labelElement.href="javascript:",labelElement.innerHTML=_this15.defaultHeaderText(),labelElement.onclick=function(){return _this15.handleSort()},_this15._iconElement=document.createElement("span"),_this15.appendChild(labelElement),_this15.appendChild(_this15._iconElement),_this15.sorting.add(function(){return _this15._iconElement.innerHTML=_this15.sortingHTML}),_this15.sorted.add(function(){return _this15.updateSortIcon()})}else _this15.element.innerHTML=_this15.defaultHeaderText();return _this15.style(field.headerStyle),_this15}return _inherits(GridViewHeaderCell,_wuzhui$Control4),_createClass(GridViewHeaderCell,[{key:"handleSort",value:function(){var _this16=this,selectArguments=this.field.gridView.selectArguments,sortType="asc"==this.sortType?"desc":"asc";return wuzhui.fireCallback(this.sorting,this,{sortType:sortType}),selectArguments.sortExpression=this.field.sortExpression+" "+sortType,this.field.gridView.dataSource.select(selectArguments).then(function(){_this16.sortType=sortType,wuzhui.fireCallback(_this16.sorted,_this16,{sortType:sortType})})}},{key:"defaultHeaderText",value:function(){return this.field.headerText||this.field.dataField||""}},{key:"clearSortIcon",value:function(){this._iconElement.innerHTML=""}},{key:"updateSortIcon",value:function(){"asc"==this.sortType?this._iconElement.innerHTML="↑":"desc"==this.sortType?this._iconElement.innerHTML="↓":this._iconElement.innerHTML=""}},{key:"sortType",get:function(){return this._sortType},set:function(value){this._sortType=value}}]),GridViewHeaderCell}(wuzhui.Control);wuzhui.GridViewHeaderCell=GridViewHeaderCell;var DataControlField=function(){function DataControlField(params){_classCallCheck(this,DataControlField),null==params.visible&&(params.visible=!0),this._params=params}return _createClass(DataControlField,[{key:"createHeaderCell",value:function(){var cell=new GridViewHeaderCell(this);return cell}},{key:"createFooterCell",value:function(){var cell=new GridViewCell;return cell.element.innerHTML=this.footerText||"",cell.style(this.footerStyle),cell}},{key:"createItemCell",value:function(dataItem){if(!dataItem)throw wuzhui.Errors.argumentNull("dataItem");var cell=new GridViewCell;return cell.style(this.itemStyle),cell}},{key:"footerText",get:function(){return this._params.footerText},set:function(value){this._params.footerText=value}},{key:"headerText",get:function(){return this._params.headerText},set:function(value){this._params.headerText=value}},{key:"itemStyle",get:function(){return this._params.itemStyle},set:function(value){this._params.itemStyle=value}},{key:"footerStyle",get:function(){return this._params.footerStyle},set:function(value){this._params.footerStyle=value}},{key:"headerStyle",get:function(){return this._params.headerStyle},set:function(value){this._params.headerStyle=value}},{key:"visible",get:function(){return this._params.visible}},{key:"gridView",get:function(){return this._gridView},set:function(value){this._gridView=value}},{key:"sortExpression",get:function(){return this._params.sortExpression},set:function(value){this._params.sortExpression=value}}]),DataControlField}();wuzhui.DataControlField=DataControlField}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var GridViewEditableCell=function(_wuzhui$GridViewDataC){function GridViewEditableCell(field,dataItem,valueType){if(_classCallCheck(this,GridViewEditableCell),null==field)throw wuzhui.Errors.argumentNull("field");if(null==dataItem)throw wuzhui.Errors.argumentNull("dataItem");var _this17=_possibleConstructorReturn(this,(GridViewEditableCell.__proto__||Object.getPrototypeOf(GridViewEditableCell)).call(this,{dataField:field.dataField,nullText:field.nullText,dataFormatString:field.dataFormatString}));if(_this17._field=field,_this17._dataItem=dataItem,_this17._valueType=valueType,_this17._mode="read",!_this17._valueType){var value=dataItem[field.dataField];value instanceof Date?_this17._valueType="date":_this17._valueType="undefined"==typeof value?"undefined":_typeof(value)}return _this17}return _inherits(GridViewEditableCell,_wuzhui$GridViewDataC),_createClass(GridViewEditableCell,[{key:"beginEdit",value:function(){this._field.readOnly||(this._mode="edit",this.render(this._dataItem))}},{key:"endEdit",value:function(){if(!this._field.readOnly){this._mode="read";this.controlValue;this.render(this._dataItem)}}},{key:"cancelEdit",value:function(){this._field.readOnly||(this._mode="read",this.render(this._dataItem))}},{key:"render",value:function(dataItem){var value=dataItem[this.field.dataField];return"edit"==this._mode?(this.element.innerHTML='<input type="text" />',wuzhui.applyStyle(this.element.querySelector("input"),this._field.controlStyle),void(this.element.querySelector("input").value=void 0===value?null:""+value)):void _get(GridViewEditableCell.prototype.__proto__||Object.getPrototypeOf(GridViewEditableCell.prototype),"render",this).call(this,dataItem)}},{key:"field",get:function(){return this._field}},{key:"mode",get:function(){return this._mode}},{key:"controlValue",get:function(){var text=this.element.querySelector("input").value;switch(this._valueType){case"number":return new Number(text).valueOf();case"date":return new Date(text);default:return text}}}]),GridViewEditableCell}(wuzhui.GridViewDataCell);wuzhui.GridViewEditableCell=GridViewEditableCell;var BoundField=function(_wuzhui$DataControlFi){function BoundField(params){_classCallCheck(this,BoundField);var _this18=_possibleConstructorReturn(this,(BoundField.__proto__||Object.getPrototypeOf(BoundField)).call(this,params));return _this18._params=params,_this18._valueElement=document.createElement("span"),_this18}return _inherits(BoundField,_wuzhui$DataControlFi),_createClass(BoundField,[{key:"params",value:function(){return this._params}},{key:"createItemCell",value:function(dataItem){var cell=new GridViewEditableCell(this,dataItem);return cell.style(this.itemStyle),cell}},{key:"nullText",get:function(){return this.params().nullText}},{key:"dataField",get:function(){return this.params().dataField}},{key:"dataFormatString",get:function(){return this.params().dataFormatString}},{key:"controlStyle",get:function(){return this.params().controlStyle}},{key:"readOnly",get:function(){return this.params().readOnly}}]),BoundField}(wuzhui.DataControlField);wuzhui.BoundField=BoundField}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var GridViewCommandCell=function(_wuzhui$GridViewCell){function GridViewCommandCell(field){return _classCallCheck(this,GridViewCommandCell),_possibleConstructorReturn(this,(GridViewCommandCell.__proto__||Object.getPrototypeOf(GridViewCommandCell)).call(this))}return _inherits(GridViewCommandCell,_wuzhui$GridViewCell),GridViewCommandCell}(wuzhui.GridViewCell),CommandField=function(_wuzhui$DataControlFi2){function CommandField(params){_classCallCheck(this,CommandField);var _this20=_possibleConstructorReturn(this,(CommandField.__proto__||Object.getPrototypeOf(CommandField)).call(this,params));return _this20.params().cancelButtonHTML||(_this20.params().cancelButtonHTML="取消"),_this20.params().deleteButtonHTML||(_this20.params().deleteButtonHTML="删除"),_this20.params().editButtonHTML||(_this20.params().editButtonHTML="编辑"),_this20.params().updateButtonHTML||(_this20.params().updateButtonHTML="更新"),_this20.params().newButtonHTML||(_this20.params().newButtonHTML="新增"),_this20.params().insertButtonHTML||(_this20.params().insertButtonHTML="添加"),_this20}return _inherits(CommandField,_wuzhui$DataControlFi2),_createClass(CommandField,[{key:"params",value:function(){return this._params}},{key:"createItemCell",value:function(dataItem){var _this21=this,cell=new GridViewCommandCell(this);if(cell.style(this.itemStyle),this.params().showEditButton){var editButton=this.createEditButton();editButton.style.marginRight="4px",this.editButtonClass&&(editButton.className=this.editButtonClass),cell.editButton=editButton,editButton.addEventListener("click",function(e){return _this21.on_editButtonClick(e)}),cell.appendChild(editButton);var updateButton=this.createUpdateButton();updateButton.style.display="none",updateButton.style.marginRight="4px",this.updateButtonClass&&(updateButton.className=this.updateButtonClass),cell.updateButton=updateButton,updateButton.addEventListener("click",function(e){return _this21.on_insertOrUpdateButtonClick(e)}),cell.appendChild(updateButton);var cancelButton=this.createCancelButton();cancelButton.style.display="none",cancelButton.style.marginRight="4px",this.cancelButtonClass&&(cancelButton.className=this.cancelButtonClass),cell.cacelButton=cancelButton,cancelButton.addEventListener("click",function(e){return _this21.on_cancelButtonClick(e)}),cell.appendChild(cancelButton)}if(this.params().showDeleteButton){var deleteButton=this.createDeleteButton();deleteButton.style.marginRight="4px",this.deleteButtonClass&&(deleteButton.className=this.deleteButtonClass),cell.deleteButton=deleteButton,deleteButton.onclick=function(e){return _this21.on_deleteButtonClick(e)},cell.appendChild(deleteButton)}if(this.params().showNewButton){var newButton=this.createNewButton();newButton.style.marginRight="4px",this.newButtonClass&&(newButton.className=this.newButtonClass),newButton.onclick=function(e){return _this21.on_newButtonClick(e)},cell.newButton=newButton,cell.appendChild(newButton);var insertButton=this.createInsertButton();insertButton.style.display="none",insertButton.style.marginRight="4px",insertButton.addEventListener("click",function(e){return _this21.on_insertOrUpdateButtonClick(e)}),this.insertButtonClass&&(insertButton.className=this.updateButtonClass),cell.insertButton=insertButton,cell.appendChild(insertButton);var _cancelButton=this.createCancelButton();_cancelButton.style.display="none",_cancelButton.style.marginRight="4px",_cancelButton.addEventListener("click",function(e){return _this21.on_cancelButtonClick(e)}),this.cancelButtonClass&&(_cancelButton.className=this.cancelButtonClass),cell.cacelButton=_cancelButton,cell.appendChild(_cancelButton)}return cell}},{key:"showReadStatusButtons",value:function(cell){cell.newButton&&(this.showButton(cell.newButton),this.hideButton(cell.insertButton)),cell.editButton&&(this.showButton(cell.editButton),this.hideButton(cell.updateButton)),cell.deleteButton&&this.showButton(cell.deleteButton),this.hideButton(cell.cacelButton)}},{key:"createEditButton",value:function(){var button=document.createElement("a");return button.innerHTML=this.editButtonHTML,button.href="javascript:",button}},{key:"createDeleteButton",value:function(){var button=document.createElement("a");return button.innerHTML=this.deleteButtonHTML,button.href="javascript:",button}},{key:"createInsertButton",value:function(){var button=document.createElement("a");return button.innerHTML=this.insertButtonHTML,button.href="javascript:",button}},{key:"createUpdateButton",value:function(){var button=document.createElement("a");return button.innerHTML=this.updateButtonHTML,button.href="javascript:",button}},{key:"createCancelButton",value:function(){var button=document.createElement("a");return button.innerHTML=this.cancelButtonHTML,button.href="javascript:",button}},{key:"createNewButton",value:function(){var button=document.createElement("a");return button.innerHTML=this.newButtonHTML,button.href="javascript:",button}},{key:"hideButton",value:function(button){button.style.display="none"}},{key:"showButton",value:function(button){button.style.removeProperty("display")}},{key:"findParentCell",value:function(element){for(var cellElement=void 0,p=element.parentElement;p;){if("TD"==p.tagName){cellElement=p;break}p=p.parentElement}return cellElement}},{key:"on_editButtonClick",value:function(e){var cellElement=this.findParentCell(e.target);console.assert(null!=cellElement);for(var rowElement=cellElement.parentElement,i=0;i<rowElement.cells.length;i++){var _cell=wuzhui.Control.getControlByElement(rowElement.cells[i]);_cell instanceof wuzhui.GridViewEditableCell&&_cell.beginEdit()}var cell=wuzhui.Control.getControlByElement(cellElement);this.showButton(cell.cacelButton),this.showButton(cell.updateButton),this.hideButton(cell.editButton),cell.deleteButton&&this.hideButton(cell.deleteButton),cell.newButton&&this.hideButton(cell.newButton)}},{key:"on_cancelButtonClick",value:function(e){var cellElement=this.findParentCell(e.target);console.assert(null!=cellElement);var rowElement=cellElement.parentElement,row=wuzhui.Control.getControlByElement(rowElement);if(1==row.isNew)return void rowElement.remove();for(var i=0;i<rowElement.cells.length;i++){var _cell2=wuzhui.Control.getControlByElement(rowElement.cells[i]);_cell2 instanceof wuzhui.GridViewEditableCell&&_cell2.cancelEdit()}var cell=wuzhui.Control.getControlByElement(cellElement);this.hideButton(cell.cacelButton),this.hideButton(cell.updateButton),this.showButton(cell.editButton),cell.deleteButton&&this.showButton(cell.deleteButton),cell.newButton&&this.showButton(cell.newButton)}},{key:"on_insertOrUpdateButtonClick",value:function(e){var _this22=this;e.target._updating&&(e.target._updating=!0);for(var cellElement=wuzhui.ElementHelper.findFirstParentByTagName(e.target,"td"),rowElement=cellElement.parentElement,cell=wuzhui.Control.getControlByElement(cellElement),row=wuzhui.Control.getControlByElement(rowElement),dataItem=Object.assign({},row.dataItem||{}),dataSource=row.gridView.dataSource,editableCells=new Array,i=0;i<rowElement.cells.length;i++){var _cell3=wuzhui.Control.getControlByElement(rowElement.cells[i]);_cell3 instanceof wuzhui.GridViewEditableCell&&"edit"==_cell3.mode&&(dataItem[_cell3.field.dataField]=_cell3.controlValue,editableCells.push(_cell3))}var isInsert=e.target==cell.insertButton,p=isInsert?dataSource.insert(dataItem,rowElement.rowIndex):dataSource.update(dataItem);return p.then(function(){if(isInsert)return void rowElement.remove();editableCells.forEach(function(item){return item.endEdit()});var cell=wuzhui.Control.getControlByElement(cellElement);_this22.showReadStatusButtons(cell),e.target._updating=!1})["catch"](function(){return e.target._updating=!1})}},{key:"on_deleteButtonClick",value:function(e){var rowElement=wuzhui.ElementHelper.findFirstParentByTagName(e.target,"tr"),row=wuzhui.Control.getControlByElement(rowElement),dataSource=row.gridView.dataSource;dataSource["delete"](row.dataItem).then(function(){rowElement.remove()})}},{key:"on_newButtonClick",value:function(e){var _this23=this,rowElement=wuzhui.ElementHelper.findFirstParentByTagName(e.target,"tr"),row=wuzhui.Control.getControlByElement(rowElement),gridView=row.gridView,newRow=gridView.appendDataRow({},rowElement.rowIndex);newRow.isNew=!0;var commandCells=newRow.cells.filter(function(o){return o instanceof GridViewCommandCell});newRow.cells.filter(function(o){return o instanceof wuzhui.GridViewEditableCell}).forEach(function(c){return c.beginEdit()}),commandCells.forEach(function(cell){cell.deleteButton&&_this23.hideButton(cell.deleteButton),cell.editButton&&_this23.hideButton(cell.editButton),_this23.hideButton(cell.newButton),_this23.showButton(cell.insertButton),_this23.showButton(cell.cacelButton)})}},{key:"cancelButtonHTML",get:function(){return this.params().cancelButtonHTML}},{key:"deleteButtonHTML",get:function(){return this.params().deleteButtonHTML}},{key:"editButtonHTML",get:function(){return this.params().editButtonHTML}},{key:"updateButtonHTML",get:function(){return this.params().updateButtonHTML}},{key:"newButtonHTML",get:function(){return this.params().newButtonHTML}},{key:"insertButtonHTML",get:function(){return this.params().insertButtonHTML}},{key:"cancelButtonClass",get:function(){return this.params().cancelButtonClass}},{key:"deleteButtonClass",get:function(){return this.params().deleteButtonClass}},{key:"editButtonClass",get:function(){return this.params().editButtonClass}},{key:"newButtonClass",get:function(){return this.params().newButtonClass}},{key:"updateButtonClass",get:function(){return this.params().updateButtonClass}},{key:"insertButtonClass",get:function(){return this.params().insertButtonClass}}]),CommandField}(wuzhui.DataControlField);wuzhui.CommandField=CommandField}(wuzhui||(wuzhui={}));var wuzhui;!function(wuzhui){var CustomField=function(_wuzhui$DataControlFi3){function CustomField(params){return _classCallCheck(this,CustomField),_possibleConstructorReturn(this,(CustomField.__proto__||Object.getPrototypeOf(CustomField)).call(this,params))}return _inherits(CustomField,_wuzhui$DataControlFi3),_createClass(CustomField,[{key:"params",value:function(){return this._params}},{key:"createHeaderCell",value:function(){if(this.params().createHeaderCell){var cell=this.params().createHeaderCell();return cell.style(this.headerStyle),cell}return _get(CustomField.prototype.__proto__||Object.getPrototypeOf(CustomField.prototype),"createHeaderCell",this).call(this)}},{key:"createFooterCell",value:function(){if(this.params().createFooterCell){var cell=this.params().createFooterCell();return cell.style(this.params().footerStyle),cell}return _get(CustomField.prototype.__proto__||Object.getPrototypeOf(CustomField.prototype),"createFooterCell",this).call(this)}},{key:"createItemCell",value:function(dataItem){if(this.params().createItemCell){var cell=this.params().createItemCell.apply(this,[dataItem]);return cell.style(this.params().itemStyle),cell}return _get(CustomField.prototype.__proto__||Object.getPrototypeOf(CustomField.prototype),"createItemCell",this).call(this,dataItem)}}]),CustomField}(wuzhui.DataControlField);wuzhui.CustomField=CustomField}(wuzhui||(wuzhui={}));