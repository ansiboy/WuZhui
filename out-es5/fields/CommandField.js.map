{"version":3,"sources":["../../out/fields/CommandField.js"],"names":["GridViewCommandCell","field","GridViewCell","CommandField","params","cancelButtonHTML","deleteButtonHTML","editButtonHTML","updateButtonHTML","newButtonHTML","insertButtonHTML","dataItem","cell","style","itemStyle","showEditButton","editButton","createEditButton","marginRight","editButtonClass","className","addEventListener","e","on_editButtonClick","appendChild","updateButton","createUpdateButton","display","updateButtonClass","on_insertOrUpdateButtonClick","cancelButton","createCancelButton","cancelButtonClass","cacelButton","on_cancelButtonClick","showDeleteButton","deleteButton","createDeleteButton","deleteButtonClass","onclick","on_deleteButtonClick","showNewButton","newButton","createNewButton","newButtonClass","on_newButtonClick","insertButton","createInsertButton","insertButtonClass","showButton","hideButton","button","document","createElement","innerHTML","href","removeProperty","element","cellElement","p","parentElement","tagName","findParentCell","target","console","assert","rowElement","i","cells","length","Control","getControlByElement","GridViewEditableCell","beginEdit","row","remove","cancelEdit","ElementHelper","findFirstParentByTagName","Object","assign","dataSource","gridView","editableCells","Array","mode","dataField","controlValue","push","isInsert","insert","rowIndex","update","then","forEach","item","endEdit","showReadStatusButtons","catch","delete","newRow","appendDataRow","commandCells","filter","o","c","DataControlField"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;IACMA,mB;;;;;AACF,+BAAYC,KAAZ,EAAmB;AAAA;;AAAA;AAElB;;;EAH6BC,+B;;IAKrBC,Y;;;;;AACT,wBAAYC,MAAZ,EAAoB;AAAA;;AAAA;;AAChB,+BAAMA,MAAN;AACA,QAAI,CAAC,MAAKA,MAAL,CAAYC,gBAAjB,EACI,MAAKD,MAAL,CAAYC,gBAAZ,GAA+B,IAA/B;AACJ,QAAI,CAAC,MAAKD,MAAL,CAAYE,gBAAjB,EACI,MAAKF,MAAL,CAAYE,gBAAZ,GAA+B,IAA/B;AACJ,QAAI,CAAC,MAAKF,MAAL,CAAYG,cAAjB,EACI,MAAKH,MAAL,CAAYG,cAAZ,GAA6B,IAA7B;AACJ,QAAI,CAAC,MAAKH,MAAL,CAAYI,gBAAjB,EACI,MAAKJ,MAAL,CAAYI,gBAAZ,GAA+B,IAA/B;AACJ,QAAI,CAAC,MAAKJ,MAAL,CAAYK,aAAjB,EACI,MAAKL,MAAL,CAAYK,aAAZ,GAA4B,IAA5B;AACJ,QAAI,CAAC,MAAKL,MAAL,CAAYM,gBAAjB,EACI,MAAKN,MAAL,CAAYM,gBAAZ,GAA+B,IAA/B;AAbY;AAcnB,G,CACD;AACA;AACA;;;;;mCAqCeC,Q,EAAU;AAAA;;AACrB,UAAIC,IAAI,GAAG,IAAIZ,mBAAJ,CAAwB,IAAxB,CAAX;AACAY,MAAAA,IAAI,CAACC,KAAL,CAAW,KAAKC,SAAhB;;AACA,UAAI,KAAKV,MAAL,CAAYW,cAAhB,EAAgC;AAC5B,YAAIC,UAAU,GAAG,KAAKC,gBAAL,EAAjB;AACAD,QAAAA,UAAU,CAACH,KAAX,CAAiBK,WAAjB,GAA+B,KAA/B;AACA,YAAI,KAAKC,eAAT,EACIH,UAAU,CAACI,SAAX,GAAuB,KAAKD,eAA5B;AACJP,QAAAA,IAAI,CAACI,UAAL,GAAkBA,UAAlB;AACAA,QAAAA,UAAU,CAACK,gBAAX,CAA4B,OAA5B,EAAqC,UAACC,CAAD;AAAA,iBAAO,MAAI,CAACC,kBAAL,CAAwBD,CAAxB,CAAP;AAAA,SAArC;AACAV,QAAAA,IAAI,CAACY,WAAL,CAAiBR,UAAjB;AACA,YAAIS,YAAY,GAAG,KAAKC,kBAAL,EAAnB;AACAD,QAAAA,YAAY,CAACZ,KAAb,CAAmBc,OAAnB,GAA6B,MAA7B;AACAF,QAAAA,YAAY,CAACZ,KAAb,CAAmBK,WAAnB,GAAiC,KAAjC;AACA,YAAI,KAAKU,iBAAT,EACIH,YAAY,CAACL,SAAb,GAAyB,KAAKQ,iBAA9B;AACJhB,QAAAA,IAAI,CAACa,YAAL,GAAoBA,YAApB;AACAA,QAAAA,YAAY,CAACJ,gBAAb,CAA8B,OAA9B,EAAuC,UAACC,CAAD;AAAA,iBAAO,MAAI,CAACO,4BAAL,CAAkCP,CAAlC,CAAP;AAAA,SAAvC;AACAV,QAAAA,IAAI,CAACY,WAAL,CAAiBC,YAAjB;AACA,YAAIK,YAAY,GAAG,KAAKC,kBAAL,EAAnB;AACAD,QAAAA,YAAY,CAACjB,KAAb,CAAmBc,OAAnB,GAA6B,MAA7B;AACAG,QAAAA,YAAY,CAACjB,KAAb,CAAmBK,WAAnB,GAAiC,KAAjC;AACA,YAAI,KAAKc,iBAAT,EACIF,YAAY,CAACV,SAAb,GAAyB,KAAKY,iBAA9B;AACJpB,QAAAA,IAAI,CAACqB,WAAL,GAAmBH,YAAnB;AACAA,QAAAA,YAAY,CAACT,gBAAb,CAA8B,OAA9B,EAAuC,UAACC,CAAD;AAAA,iBAAO,MAAI,CAACY,oBAAL,CAA0BZ,CAA1B,CAAP;AAAA,SAAvC;AACAV,QAAAA,IAAI,CAACY,WAAL,CAAiBM,YAAjB;AACH;;AACD,UAAI,KAAK1B,MAAL,CAAY+B,gBAAhB,EAAkC;AAC9B,YAAIC,YAAY,GAAG,KAAKC,kBAAL,EAAnB;AACAD,QAAAA,YAAY,CAACvB,KAAb,CAAmBK,WAAnB,GAAiC,KAAjC;AACA,YAAI,KAAKoB,iBAAT,EACIF,YAAY,CAAChB,SAAb,GAAyB,KAAKkB,iBAA9B;AACJ1B,QAAAA,IAAI,CAACwB,YAAL,GAAoBA,YAApB;;AACAA,QAAAA,YAAY,CAACG,OAAb,GAAuB,UAACjB,CAAD;AAAA,iBAAO,MAAI,CAACkB,oBAAL,CAA0BlB,CAA1B,CAAP;AAAA,SAAvB;;AACAV,QAAAA,IAAI,CAACY,WAAL,CAAiBY,YAAjB;AACH;;AACD,UAAI,KAAKhC,MAAL,CAAYqC,aAAhB,EAA+B;AAC3B,YAAIC,SAAS,GAAG,KAAKC,eAAL,EAAhB;AACAD,QAAAA,SAAS,CAAC7B,KAAV,CAAgBK,WAAhB,GAA8B,KAA9B;AACA,YAAI,KAAK0B,cAAT,EACIF,SAAS,CAACtB,SAAV,GAAsB,KAAKwB,cAA3B;;AACJF,QAAAA,SAAS,CAACH,OAAV,GAAoB,UAACjB,CAAD;AAAA,iBAAO,MAAI,CAACuB,iBAAL,CAAuBvB,CAAvB,CAAP;AAAA,SAApB;;AACAV,QAAAA,IAAI,CAAC8B,SAAL,GAAiBA,SAAjB;AACA9B,QAAAA,IAAI,CAACY,WAAL,CAAiBkB,SAAjB;AACA,YAAII,YAAY,GAAG,KAAKC,kBAAL,EAAnB;AACAD,QAAAA,YAAY,CAACjC,KAAb,CAAmBc,OAAnB,GAA6B,MAA7B;AACAmB,QAAAA,YAAY,CAACjC,KAAb,CAAmBK,WAAnB,GAAiC,KAAjC;AACA4B,QAAAA,YAAY,CAACzB,gBAAb,CAA8B,OAA9B,EAAuC,UAACC,CAAD;AAAA,iBAAO,MAAI,CAACO,4BAAL,CAAkCP,CAAlC,CAAP;AAAA,SAAvC;AACA,YAAI,KAAK0B,iBAAT,EACIF,YAAY,CAAC1B,SAAb,GAAyB,KAAKQ,iBAA9B;AACJhB,QAAAA,IAAI,CAACkC,YAAL,GAAoBA,YAApB;AACAlC,QAAAA,IAAI,CAACY,WAAL,CAAiBsB,YAAjB;;AACA,YAAIhB,aAAY,GAAG,KAAKC,kBAAL,EAAnB;;AACAD,QAAAA,aAAY,CAACjB,KAAb,CAAmBc,OAAnB,GAA6B,MAA7B;AACAG,QAAAA,aAAY,CAACjB,KAAb,CAAmBK,WAAnB,GAAiC,KAAjC;;AACAY,QAAAA,aAAY,CAACT,gBAAb,CAA8B,OAA9B,EAAuC,UAACC,CAAD;AAAA,iBAAO,MAAI,CAACY,oBAAL,CAA0BZ,CAA1B,CAAP;AAAA,SAAvC;;AACA,YAAI,KAAKU,iBAAT,EACIF,aAAY,CAACV,SAAb,GAAyB,KAAKY,iBAA9B;AACJpB,QAAAA,IAAI,CAACqB,WAAL,GAAmBH,aAAnB;AACAlB,QAAAA,IAAI,CAACY,WAAL,CAAiBM,aAAjB;AACH;;AACD,aAAOlB,IAAP;AACH;;;0CACqBA,I,EAAM;AACxB,UAAIA,IAAI,CAAC8B,SAAT,EAAoB;AAChB,aAAKO,UAAL,CAAgBrC,IAAI,CAAC8B,SAArB;AACA,aAAKQ,UAAL,CAAgBtC,IAAI,CAACkC,YAArB;AACH;;AACD,UAAIlC,IAAI,CAACI,UAAT,EAAqB;AACjB,aAAKiC,UAAL,CAAgBrC,IAAI,CAACI,UAArB;AACA,aAAKkC,UAAL,CAAgBtC,IAAI,CAACa,YAArB;AACH;;AACD,UAAIb,IAAI,CAACwB,YAAT,EACI,KAAKa,UAAL,CAAgBrC,IAAI,CAACwB,YAArB;AACJ,WAAKc,UAAL,CAAgBtC,IAAI,CAACqB,WAArB;AACH;;;uCACkB;AACf,UAAIkB,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,SAAP,GAAmB,KAAK/C,cAAxB;AACA4C,MAAAA,MAAM,CAACI,IAAP,GAAc,aAAd;AACA,aAAOJ,MAAP;AACH;;;yCACoB;AACjB,UAAIA,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,SAAP,GAAmB,KAAKhD,gBAAxB;AACA6C,MAAAA,MAAM,CAACI,IAAP,GAAc,aAAd;AACA,aAAOJ,MAAP;AACH;;;yCACoB;AACjB,UAAIA,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,SAAP,GAAmB,KAAK5C,gBAAxB;AACAyC,MAAAA,MAAM,CAACI,IAAP,GAAc,aAAd;AACA,aAAOJ,MAAP;AACH;;;yCACoB;AACjB,UAAIA,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,SAAP,GAAmB,KAAK9C,gBAAxB;AACA2C,MAAAA,MAAM,CAACI,IAAP,GAAc,aAAd;AACA,aAAOJ,MAAP;AACH;;;yCACoB;AACjB,UAAIA,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,SAAP,GAAmB,KAAKjD,gBAAxB;AACA8C,MAAAA,MAAM,CAACI,IAAP,GAAc,aAAd;AACA,aAAOJ,MAAP;AACH;;;sCACiB;AACd,UAAIA,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,SAAP,GAAmB,KAAK7C,aAAxB;AACA0C,MAAAA,MAAM,CAACI,IAAP,GAAc,aAAd;AACA,aAAOJ,MAAP;AACH;;;+BACUA,M,EAAQ;AACfA,MAAAA,MAAM,CAACtC,KAAP,CAAac,OAAb,GAAuB,MAAvB;AACH;;;+BACUwB,M,EAAQ;AACfA,MAAAA,MAAM,CAACtC,KAAP,CAAa2C,cAAb,CAA4B,SAA5B;AACH;;;mCACcC,O,EAAS;AACpB,UAAIC,WAAJ;AACA,UAAIC,CAAC,GAAGF,OAAO,CAACG,aAAhB;;AACA,aAAOD,CAAP,EAAU;AACN,YAAIA,CAAC,CAACE,OAAF,IAAa,IAAjB,EAAuB;AACnBH,UAAAA,WAAW,GAAGC,CAAd;AACA;AACH;;AACDA,QAAAA,CAAC,GAAGA,CAAC,CAACC,aAAN;AACH;;AACD,aAAOF,WAAP;AACH;;;uCACkBpC,C,EAAG;AAClB,UAAIoC,WAAW,GAAG,KAAKI,cAAL,CAAoBxC,CAAC,CAACyC,MAAtB,CAAlB;AACAC,MAAAA,OAAO,CAACC,MAAR,CAAeP,WAAW,IAAI,IAA9B;AACA,UAAIQ,UAAU,GAAGR,WAAW,CAACE,aAA7B;;AACA,WAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACE,KAAX,CAAiBC,MAArC,EAA6CF,CAAC,EAA9C,EAAkD;AAC9C,YAAIvD,KAAI,GAAG0D,iBAAQC,mBAAR,CAA4BL,UAAU,CAACE,KAAX,CAAiBD,CAAjB,CAA5B,CAAX;;AACA,YAAIvD,KAAI,YAAY4D,0CAApB,EAA0C;AACtC5D,UAAAA,KAAI,CAAC6D,SAAL;AACH;AACJ;;AACD,UAAI7D,IAAI,GAAG0D,iBAAQC,mBAAR,CAA4Bb,WAA5B,CAAX;;AACA,WAAKT,UAAL,CAAgBrC,IAAI,CAACqB,WAArB;AACA,WAAKgB,UAAL,CAAgBrC,IAAI,CAACa,YAArB;AACA,WAAKyB,UAAL,CAAgBtC,IAAI,CAACI,UAArB;AACA,UAAIJ,IAAI,CAACwB,YAAT,EACI,KAAKc,UAAL,CAAgBtC,IAAI,CAACwB,YAArB;AACJ,UAAIxB,IAAI,CAAC8B,SAAT,EACI,KAAKQ,UAAL,CAAgBtC,IAAI,CAAC8B,SAArB;AACP;;;yCACoBpB,C,EAAG;AACpB,UAAIoC,WAAW,GAAG,KAAKI,cAAL,CAAoBxC,CAAC,CAACyC,MAAtB,CAAlB;AACAC,MAAAA,OAAO,CAACC,MAAR,CAAeP,WAAW,IAAI,IAA9B;AACA,UAAIQ,UAAU,GAAGR,WAAW,CAACE,aAA7B;;AACA,UAAIc,GAAG,GAAGJ,iBAAQC,mBAAR,CAA4BL,UAA5B,CAAV;;AACA,UAAIQ,GAAG,CAAC,OAAD,CAAH,IAAgB,IAApB,EAA0B;AACtBR,QAAAA,UAAU,CAACS,MAAX;AACA;AACH;;AACD,WAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACE,KAAX,CAAiBC,MAArC,EAA6CF,CAAC,EAA9C,EAAkD;AAC9C,YAAIvD,MAAI,GAAG0D,iBAAQC,mBAAR,CAA4BL,UAAU,CAACE,KAAX,CAAiBD,CAAjB,CAA5B,CAAX;;AACA,YAAIvD,MAAI,YAAY4D,0CAApB,EAA0C;AACtC5D,UAAAA,MAAI,CAACgE,UAAL;AACH;AACJ;;AACD,UAAIhE,IAAI,GAAG0D,iBAAQC,mBAAR,CAA4Bb,WAA5B,CAAX;;AACA,WAAKR,UAAL,CAAgBtC,IAAI,CAACqB,WAArB;AACA,WAAKiB,UAAL,CAAgBtC,IAAI,CAACa,YAArB;AACA,WAAKwB,UAAL,CAAgBrC,IAAI,CAACI,UAArB;AACA,UAAIJ,IAAI,CAACwB,YAAT,EACI,KAAKa,UAAL,CAAgBrC,IAAI,CAACwB,YAArB;AACJ,UAAIxB,IAAI,CAAC8B,SAAT,EACI,KAAKO,UAAL,CAAgBrC,IAAI,CAAC8B,SAArB;AACP;;;iDAC4BpB,C,EAAG;AAAA;;AAC5B,UAAIA,CAAC,CAACyC,MAAF,CAAS,WAAT,CAAJ,EACIzC,CAAC,CAACyC,MAAF,CAAS,WAAT,IAAwB,IAAxB;;AACJ,UAAIL,WAAW,GAAGmB,uBAAcC,wBAAd,CAAuCxD,CAAC,CAACyC,MAAzC,EAAiD,IAAjD,CAAlB;;AACA,UAAIG,UAAU,GAAGR,WAAW,CAACE,aAA7B;;AACA,UAAIhD,IAAI,GAAG0D,iBAAQC,mBAAR,CAA4Bb,WAA5B,CAAX;;AACA,UAAIgB,GAAG,GAAGJ,iBAAQC,mBAAR,CAA4BL,UAA5B,CAAV,CAN4B,CAO5B;AACA;;;AACA,UAAIvD,QAAQ,GAAGoE,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBN,GAAG,CAAC/D,QAAJ,IAAgB,EAAlC,CAAf,CAT4B,CAU5B;;AACA,UAAIsE,UAAU,GAAGP,GAAG,CAACQ,QAAJ,CAAaD,UAA9B;AACA,UAAIE,aAAa,GAAG,IAAIC,KAAJ,EAApB;;AACA,WAAK,IAAIjB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACE,KAAX,CAAiBC,MAArC,EAA6CF,CAAC,EAA9C,EAAkD;AAC9C,YAAIvD,MAAI,GAAG0D,iBAAQC,mBAAR,CAA4BL,UAAU,CAACE,KAAX,CAAiBD,CAAjB,CAA5B,CAAX;;AACA,YAAIvD,MAAI,YAAY4D,0CAAhB,IAAwC5D,MAAI,CAACyE,IAAL,IAAa,MAAzD,EAAiE;AAC7D1E,UAAAA,QAAQ,CAACC,MAAI,CAACX,KAAL,CAAWqF,SAAZ,CAAR,GAAiC1E,MAAI,CAAC2E,YAAtC;AACAJ,UAAAA,aAAa,CAACK,IAAd,CAAmB5E,MAAnB;AACH;AACJ;;AACD,UAAI6E,QAAQ,GAAGnE,CAAC,CAACyC,MAAF,IAAYnD,IAAI,CAACkC,YAAhC;AACA,UAAIa,CAAC,GAAG8B,QAAQ,GAAGR,UAAU,CAACS,MAAX,CAAkB/E,QAAlB,EAA4BuD,UAAU,CAACyB,QAAvC,CAAH,GAAsDV,UAAU,CAACW,MAAX,CAAkBjF,QAAlB,CAAtE;AACA,aAAOgD,CAAC,CAACkC,IAAF,CAAO,YAAM;AAChB,YAAIJ,QAAJ,EAAc;AACVvB,UAAAA,UAAU,CAACS,MAAX;AACA;AACH;;AACDQ,QAAAA,aAAa,CAACW,OAAd,CAAsB,UAACC,IAAD;AAAA,iBAAUA,IAAI,CAACC,OAAL,EAAV;AAAA,SAAtB;;AACA,YAAIpF,IAAI,GAAG0D,iBAAQC,mBAAR,CAA4Bb,WAA5B,CAAX;;AACA,QAAA,MAAI,CAACuC,qBAAL,CAA2BrF,IAA3B;;AACAU,QAAAA,CAAC,CAACyC,MAAF,CAAS,WAAT,IAAwB,KAAxB;AACH,OATM,EASJmC,KATI,CASE;AAAA,eAAM5E,CAAC,CAACyC,MAAF,CAAS,WAAT,IAAwB,KAA9B;AAAA,OATF,CAAP;AAUH;;;yCACoBzC,C,EAAG;AACpB,UAAI4C,UAAU,GAAGW,uBAAcC,wBAAd,CAAuCxD,CAAC,CAACyC,MAAzC,EAAiD,IAAjD,CAAjB;;AACA,UAAIW,GAAG,GAAGJ,iBAAQC,mBAAR,CAA4BL,UAA5B,CAAV;;AACA,UAAIe,UAAU,GAAGP,GAAG,CAACQ,QAAJ,CAAaD,UAA9B;AACAA,MAAAA,UAAU,CAACkB,MAAX,CAAkBzB,GAAG,CAAC/D,QAAtB,EACKkF,IADL,CACU,YAAM;AACZ3B,QAAAA,UAAU,CAACS,MAAX;AACH,OAHD;AAIH;;;sCACiBrD,C,EAAG;AAAA;;AACjB,UAAI4C,UAAU,GAAGW,uBAAcC,wBAAd,CAAuCxD,CAAC,CAACyC,MAAzC,EAAiD,IAAjD,CAAjB,CADiB,CACwD;;;AACzE,UAAIW,GAAG,GAAGJ,iBAAQC,mBAAR,CAA4BL,UAA5B,CAAV;;AACA,UAAIgB,QAAQ,GAAGR,GAAG,CAACQ,QAAnB;AACA,UAAIkB,MAAM,GAAGlB,QAAQ,CAACmB,aAAT,CAAuB,EAAvB,EAA2BnC,UAAU,CAACyB,QAAtC,CAAb;AACAS,MAAAA,MAAM,CAAC,OAAD,CAAN,GAAkB,IAAlB;AACA,UAAIE,YAAY,GAAGF,MAAM,CAAChC,KAAP,CAAamC,MAAb,CAAoB,UAAAC,CAAC;AAAA,eAAIA,CAAC,YAAYxG,mBAAjB;AAAA,OAArB,CAAnB;AACAoG,MAAAA,MAAM,CAAChC,KAAP,CAAamC,MAAb,CAAoB,UAAAC,CAAC;AAAA,eAAIA,CAAC,YAAYhC,0CAAjB;AAAA,OAArB,EACKsB,OADL,CACa,UAACW,CAAD;AAAA,eAAOA,CAAC,CAAChC,SAAF,EAAP;AAAA,OADb;AAEA6B,MAAAA,YAAY,CAACR,OAAb,CAAqB,UAAClF,IAAD,EAAU;AAC3B,YAAIA,IAAI,CAACwB,YAAT,EACI,MAAI,CAACc,UAAL,CAAgBtC,IAAI,CAACwB,YAArB;AACJ,YAAIxB,IAAI,CAACI,UAAT,EACI,MAAI,CAACkC,UAAL,CAAgBtC,IAAI,CAACI,UAArB;;AACJ,QAAA,MAAI,CAACkC,UAAL,CAAgBtC,IAAI,CAAC8B,SAArB;;AACA,QAAA,MAAI,CAACO,UAAL,CAAgBrC,IAAI,CAACkC,YAArB;;AACA,QAAA,MAAI,CAACG,UAAL,CAAgBrC,IAAI,CAACqB,WAArB;AACH,OARD;AASH;;;wBA9QsB;AACnB,aAAO,KAAK7B,MAAL,CAAYC,gBAAnB;AACH;;;wBACsB;AACnB,aAAO,KAAKD,MAAL,CAAYE,gBAAnB;AACH;;;wBACoB;AACjB,aAAO,KAAKF,MAAL,CAAYG,cAAnB;AACH;;;wBACsB;AACnB,aAAO,KAAKH,MAAL,CAAYI,gBAAnB;AACH;;;wBACmB;AAChB,aAAO,KAAKJ,MAAL,CAAYK,aAAnB;AACH;;;wBACsB;AACnB,aAAO,KAAKL,MAAL,CAAYM,gBAAnB;AACH;;;wBACuB;AACpB,aAAO,KAAKN,MAAL,CAAY4B,iBAAnB;AACH;;;wBACuB;AACpB,aAAO,KAAK5B,MAAL,CAAYkC,iBAAnB;AACH;;;wBACqB;AAClB,aAAO,KAAKlC,MAAL,CAAYe,eAAnB;AACH;;;wBACoB;AACjB,aAAO,KAAKf,MAAL,CAAYwC,cAAnB;AACH;;;wBACuB;AACpB,aAAO,KAAKxC,MAAL,CAAYwB,iBAAnB;AACH;;;wBACuB;AACpB,aAAO,KAAKxB,MAAL,CAAY4C,iBAAnB;AACH;;;;EAtD6B0D,mC","sourcesContent":["/// <reference path=\"DataControlField.ts\"/>\r\nimport { GridViewCell, DataControlField } from \"./DataControlField\";\r\nimport { Control } from \"../Control\";\r\nimport { GridViewEditableCell } from \"./GridViewEditableCell\";\r\nimport { ElementHelper } from \"../Utility\";\r\nclass GridViewCommandCell extends GridViewCell {\r\n    constructor(field) {\r\n        super();\r\n    }\r\n}\r\nexport class CommandField extends DataControlField {\r\n    constructor(params) {\r\n        super(params);\r\n        if (!this.params.cancelButtonHTML)\r\n            this.params.cancelButtonHTML = '取消';\r\n        if (!this.params.deleteButtonHTML)\r\n            this.params.deleteButtonHTML = '删除';\r\n        if (!this.params.editButtonHTML)\r\n            this.params.editButtonHTML = '编辑';\r\n        if (!this.params.updateButtonHTML)\r\n            this.params.updateButtonHTML = '更新';\r\n        if (!this.params.newButtonHTML)\r\n            this.params.newButtonHTML = '新增';\r\n        if (!this.params.insertButtonHTML)\r\n            this.params.insertButtonHTML = '添加';\r\n    }\r\n    // private params(): CommandFieldParams {\r\n    //     return this.params;\r\n    // }\r\n    get cancelButtonHTML() {\r\n        return this.params.cancelButtonHTML;\r\n    }\r\n    get deleteButtonHTML() {\r\n        return this.params.deleteButtonHTML;\r\n    }\r\n    get editButtonHTML() {\r\n        return this.params.editButtonHTML;\r\n    }\r\n    get updateButtonHTML() {\r\n        return this.params.updateButtonHTML;\r\n    }\r\n    get newButtonHTML() {\r\n        return this.params.newButtonHTML;\r\n    }\r\n    get insertButtonHTML() {\r\n        return this.params.insertButtonHTML;\r\n    }\r\n    get cancelButtonClass() {\r\n        return this.params.cancelButtonClass;\r\n    }\r\n    get deleteButtonClass() {\r\n        return this.params.deleteButtonClass;\r\n    }\r\n    get editButtonClass() {\r\n        return this.params.editButtonClass;\r\n    }\r\n    get newButtonClass() {\r\n        return this.params.newButtonClass;\r\n    }\r\n    get updateButtonClass() {\r\n        return this.params.updateButtonClass;\r\n    }\r\n    get insertButtonClass() {\r\n        return this.params.insertButtonClass;\r\n    }\r\n    createItemCell(dataItem) {\r\n        let cell = new GridViewCommandCell(this);\r\n        cell.style(this.itemStyle);\r\n        if (this.params.showEditButton) {\r\n            let editButton = this.createEditButton();\r\n            editButton.style.marginRight = '4px';\r\n            if (this.editButtonClass)\r\n                editButton.className = this.editButtonClass;\r\n            cell.editButton = editButton;\r\n            editButton.addEventListener('click', (e) => this.on_editButtonClick(e));\r\n            cell.appendChild(editButton);\r\n            let updateButton = this.createUpdateButton();\r\n            updateButton.style.display = 'none';\r\n            updateButton.style.marginRight = '4px';\r\n            if (this.updateButtonClass)\r\n                updateButton.className = this.updateButtonClass;\r\n            cell.updateButton = updateButton;\r\n            updateButton.addEventListener('click', (e) => this.on_insertOrUpdateButtonClick(e));\r\n            cell.appendChild(updateButton);\r\n            let cancelButton = this.createCancelButton();\r\n            cancelButton.style.display = 'none';\r\n            cancelButton.style.marginRight = '4px';\r\n            if (this.cancelButtonClass)\r\n                cancelButton.className = this.cancelButtonClass;\r\n            cell.cacelButton = cancelButton;\r\n            cancelButton.addEventListener('click', (e) => this.on_cancelButtonClick(e));\r\n            cell.appendChild(cancelButton);\r\n        }\r\n        if (this.params.showDeleteButton) {\r\n            let deleteButton = this.createDeleteButton();\r\n            deleteButton.style.marginRight = '4px';\r\n            if (this.deleteButtonClass)\r\n                deleteButton.className = this.deleteButtonClass;\r\n            cell.deleteButton = deleteButton;\r\n            deleteButton.onclick = (e) => this.on_deleteButtonClick(e);\r\n            cell.appendChild(deleteButton);\r\n        }\r\n        if (this.params.showNewButton) {\r\n            let newButton = this.createNewButton();\r\n            newButton.style.marginRight = '4px';\r\n            if (this.newButtonClass)\r\n                newButton.className = this.newButtonClass;\r\n            newButton.onclick = (e) => this.on_newButtonClick(e);\r\n            cell.newButton = newButton;\r\n            cell.appendChild(newButton);\r\n            let insertButton = this.createInsertButton();\r\n            insertButton.style.display = 'none';\r\n            insertButton.style.marginRight = '4px';\r\n            insertButton.addEventListener('click', (e) => this.on_insertOrUpdateButtonClick(e));\r\n            if (this.insertButtonClass)\r\n                insertButton.className = this.updateButtonClass;\r\n            cell.insertButton = insertButton;\r\n            cell.appendChild(insertButton);\r\n            let cancelButton = this.createCancelButton();\r\n            cancelButton.style.display = 'none';\r\n            cancelButton.style.marginRight = '4px';\r\n            cancelButton.addEventListener('click', (e) => this.on_cancelButtonClick(e));\r\n            if (this.cancelButtonClass)\r\n                cancelButton.className = this.cancelButtonClass;\r\n            cell.cacelButton = cancelButton;\r\n            cell.appendChild(cancelButton);\r\n        }\r\n        return cell;\r\n    }\r\n    showReadStatusButtons(cell) {\r\n        if (cell.newButton) {\r\n            this.showButton(cell.newButton);\r\n            this.hideButton(cell.insertButton);\r\n        }\r\n        if (cell.editButton) {\r\n            this.showButton(cell.editButton);\r\n            this.hideButton(cell.updateButton);\r\n        }\r\n        if (cell.deleteButton)\r\n            this.showButton(cell.deleteButton);\r\n        this.hideButton(cell.cacelButton);\r\n    }\r\n    createEditButton() {\r\n        let button = document.createElement('a');\r\n        button.innerHTML = this.editButtonHTML;\r\n        button.href = 'javascript:';\r\n        return button;\r\n    }\r\n    createDeleteButton() {\r\n        let button = document.createElement('a');\r\n        button.innerHTML = this.deleteButtonHTML;\r\n        button.href = 'javascript:';\r\n        return button;\r\n    }\r\n    createInsertButton() {\r\n        let button = document.createElement('a');\r\n        button.innerHTML = this.insertButtonHTML;\r\n        button.href = 'javascript:';\r\n        return button;\r\n    }\r\n    createUpdateButton() {\r\n        let button = document.createElement('a');\r\n        button.innerHTML = this.updateButtonHTML;\r\n        button.href = 'javascript:';\r\n        return button;\r\n    }\r\n    createCancelButton() {\r\n        let button = document.createElement('a');\r\n        button.innerHTML = this.cancelButtonHTML;\r\n        button.href = 'javascript:';\r\n        return button;\r\n    }\r\n    createNewButton() {\r\n        let button = document.createElement('a');\r\n        button.innerHTML = this.newButtonHTML;\r\n        button.href = 'javascript:';\r\n        return button;\r\n    }\r\n    hideButton(button) {\r\n        button.style.display = 'none';\r\n    }\r\n    showButton(button) {\r\n        button.style.removeProperty('display');\r\n    }\r\n    findParentCell(element) {\r\n        let cellElement;\r\n        let p = element.parentElement;\r\n        while (p) {\r\n            if (p.tagName == 'TD') {\r\n                cellElement = p;\r\n                break;\r\n            }\r\n            p = p.parentElement;\r\n        }\r\n        return cellElement;\r\n    }\r\n    on_editButtonClick(e) {\r\n        let cellElement = this.findParentCell(e.target);\r\n        console.assert(cellElement != null);\r\n        let rowElement = cellElement.parentElement;\r\n        for (let i = 0; i < rowElement.cells.length; i++) {\r\n            let cell = Control.getControlByElement(rowElement.cells[i]);\r\n            if (cell instanceof GridViewEditableCell) {\r\n                cell.beginEdit();\r\n            }\r\n        }\r\n        let cell = Control.getControlByElement(cellElement);\r\n        this.showButton(cell.cacelButton);\r\n        this.showButton(cell.updateButton);\r\n        this.hideButton(cell.editButton);\r\n        if (cell.deleteButton)\r\n            this.hideButton(cell.deleteButton);\r\n        if (cell.newButton)\r\n            this.hideButton(cell.newButton);\r\n    }\r\n    on_cancelButtonClick(e) {\r\n        let cellElement = this.findParentCell(e.target);\r\n        console.assert(cellElement != null);\r\n        let rowElement = cellElement.parentElement;\r\n        var row = Control.getControlByElement(rowElement);\r\n        if (row[\"isNew\"] == true) {\r\n            rowElement.remove();\r\n            return;\r\n        }\r\n        for (let i = 0; i < rowElement.cells.length; i++) {\r\n            let cell = Control.getControlByElement(rowElement.cells[i]);\r\n            if (cell instanceof GridViewEditableCell) {\r\n                cell.cancelEdit();\r\n            }\r\n        }\r\n        let cell = Control.getControlByElement(cellElement);\r\n        this.hideButton(cell.cacelButton);\r\n        this.hideButton(cell.updateButton);\r\n        this.showButton(cell.editButton);\r\n        if (cell.deleteButton)\r\n            this.showButton(cell.deleteButton);\r\n        if (cell.newButton)\r\n            this.showButton(cell.newButton);\r\n    }\r\n    on_insertOrUpdateButtonClick(e) {\r\n        if (e.target['_updating'])\r\n            e.target['_updating'] = true;\r\n        let cellElement = ElementHelper.findFirstParentByTagName(e.target, 'td');\r\n        let rowElement = cellElement.parentElement;\r\n        let cell = Control.getControlByElement(cellElement);\r\n        let row = Control.getControlByElement(rowElement);\r\n        //==========================================================\r\n        // 复制 dataItem 副本\r\n        let dataItem = Object.assign({}, row.dataItem || {});\r\n        //==========================================================\r\n        let dataSource = row.gridView.dataSource;\r\n        let editableCells = new Array();\r\n        for (let i = 0; i < rowElement.cells.length; i++) {\r\n            let cell = Control.getControlByElement(rowElement.cells[i]);\r\n            if (cell instanceof GridViewEditableCell && cell.mode == 'edit') {\r\n                dataItem[cell.field.dataField] = cell.controlValue;\r\n                editableCells.push(cell);\r\n            }\r\n        }\r\n        let isInsert = e.target == cell.insertButton;\r\n        let p = isInsert ? dataSource.insert(dataItem, rowElement.rowIndex) : dataSource.update(dataItem);\r\n        return p.then(() => {\r\n            if (isInsert) {\r\n                rowElement.remove();\r\n                return;\r\n            }\r\n            editableCells.forEach((item) => item.endEdit());\r\n            let cell = Control.getControlByElement(cellElement);\r\n            this.showReadStatusButtons(cell);\r\n            e.target['_updating'] = false;\r\n        }).catch(() => e.target['_updating'] = false);\r\n    }\r\n    on_deleteButtonClick(e) {\r\n        let rowElement = ElementHelper.findFirstParentByTagName(e.target, \"tr\");\r\n        let row = Control.getControlByElement(rowElement);\r\n        let dataSource = row.gridView.dataSource;\r\n        dataSource.delete(row.dataItem)\r\n            .then(() => {\r\n            rowElement.remove();\r\n        });\r\n    }\r\n    on_newButtonClick(e) {\r\n        let rowElement = ElementHelper.findFirstParentByTagName(e.target, \"tr\"); //cellElement.parentElement as HTMLTableRowElement;\r\n        let row = Control.getControlByElement(rowElement);\r\n        let gridView = row.gridView;\r\n        let newRow = gridView.appendDataRow({}, rowElement.rowIndex);\r\n        newRow[\"isNew\"] = true;\r\n        let commandCells = newRow.cells.filter(o => o instanceof GridViewCommandCell);\r\n        newRow.cells.filter(o => o instanceof GridViewEditableCell)\r\n            .forEach((c) => c.beginEdit());\r\n        commandCells.forEach((cell) => {\r\n            if (cell.deleteButton)\r\n                this.hideButton(cell.deleteButton);\r\n            if (cell.editButton)\r\n                this.hideButton(cell.editButton);\r\n            this.hideButton(cell.newButton);\r\n            this.showButton(cell.insertButton);\r\n            this.showButton(cell.cacelButton);\r\n        });\r\n    }\r\n}\r\n"],"file":"CommandField.js"}