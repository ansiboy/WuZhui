{"version":3,"sources":["../out/DataSource.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","DataSource","args","inserting","inserted","deleting","deleted","updating","updated","selecting","selected","error","primaryKeys","item","insert","delete","update","select","index","canInsert","Errors","dataSourceCanntInsert","argumentNull","fire","executeInsert","data","Object","assign","catch","exc","processError","canDelete","dataSourceCanntDelete","checkPrimaryKeys","executeDelete","canUpdate","dataSourceCanntUpdate","executeUpdate","theItem","otherItem","length","pk","key","indexOf","primaryKeyNull","executeSelect","dataItems","totalRowCount","Array","isArray","undefined","queryResultTypeError","method","handled","DataSourceSelectArguments","startRowIndex","maximumRows","ArrayDataSource","items","sortExpression","slice"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { Errors } from \"./Errors\";\r\nimport { fireCallback, callbacks1, callbacks } from \"./Utility\";\r\nexport class DataSource {\r\n    constructor(args) {\r\n        this.inserting = callbacks1();\r\n        this.inserted = callbacks1();\r\n        this.deleting = callbacks();\r\n        this.deleted = callbacks();\r\n        this.updating = callbacks();\r\n        this.updated = callbacks();\r\n        this.selecting = callbacks();\r\n        this.selected = callbacks();\r\n        this.error = callbacks();\r\n        this.args = args;\r\n        this.primaryKeys = args.primaryKeys || [];\r\n    }\r\n    get canDelete() {\r\n        return this.args.delete != null && this.primaryKeys.length > 0;\r\n    }\r\n    get canInsert() {\r\n        return this.args.insert != null && this.primaryKeys.length > 0;\r\n    }\r\n    get canUpdate() {\r\n        return this.args.update != null && this.primaryKeys.length > 0;\r\n    }\r\n    executeInsert(item, args) {\r\n        return this.args.insert(item, args);\r\n    }\r\n    executeDelete(item, args) {\r\n        return this.args.delete(item, args);\r\n    }\r\n    executeUpdate(item, args) {\r\n        return this.args.update(item, args);\r\n    }\r\n    executeSelect(args) {\r\n        args = args || {};\r\n        return this.args.select(args);\r\n    }\r\n    insert(item, args, index) {\r\n        if (!this.canInsert)\r\n            throw Errors.dataSourceCanntInsert();\r\n        if (!item)\r\n            throw Errors.argumentNull(\"item\");\r\n        if (typeof args == 'number') {\r\n            index = args;\r\n            args = null;\r\n        }\r\n        this.inserting.fire(this, item, index);\r\n        return this.executeInsert(item, args).then((data) => {\r\n            Object.assign(item, data);\r\n            this.inserted.fire(this, item, index);\r\n            return data;\r\n        }).catch(exc => {\r\n            this.processError(exc, 'insert');\r\n            throw exc;\r\n        });\r\n    }\r\n    delete(item, args) {\r\n        if (!this.canDelete)\r\n            throw Errors.dataSourceCanntDelete();\r\n        if (!item)\r\n            throw Errors.argumentNull(\"item\");\r\n        this.checkPrimaryKeys(item);\r\n        this.deleting.fire(this, item);\r\n        return this.executeDelete(item, args).then((data) => {\r\n            this.deleted.fire(this, item);\r\n            return data;\r\n        }).catch(exc => {\r\n            this.processError(exc, 'delete');\r\n            throw exc;\r\n        });\r\n    }\r\n    update(item, args) {\r\n        if (!this.canUpdate)\r\n            throw Errors.dataSourceCanntUpdate();\r\n        if (!item)\r\n            throw Errors.argumentNull(\"item\");\r\n        this.checkPrimaryKeys(item);\r\n        this.updating.fire(this, item);\r\n        return this.executeUpdate(item, args).then((data) => {\r\n            Object.assign(item, data);\r\n            this.updated.fire(this, item);\r\n            return data;\r\n        }).catch((exc) => {\r\n            this.processError(exc, 'update');\r\n            throw exc;\r\n        });\r\n    }\r\n    isSameItem(theItem, otherItem) {\r\n        if (theItem == null)\r\n            throw Errors.argumentNull('theItem');\r\n        if (otherItem == null)\r\n            throw Errors.argumentNull('otherItem');\r\n        if (this.primaryKeys.length == 0)\r\n            return theItem == otherItem;\r\n        this.checkPrimaryKeys(theItem);\r\n        this.checkPrimaryKeys(otherItem);\r\n        for (let pk of this.primaryKeys) {\r\n            if (theItem[pk] != otherItem[pk])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    checkPrimaryKeys(item) {\r\n        for (let key in item) {\r\n            if (item[key] == null && this.primaryKeys.indexOf(key) >= 0)\r\n                throw Errors.primaryKeyNull(key);\r\n        }\r\n    }\r\n    select(args) {\r\n        args = args || {};\r\n        fireCallback(this.selecting, this, args);\r\n        return this.executeSelect(args).then((data) => {\r\n            let dataItems;\r\n            let totalRowCount;\r\n            if (Array.isArray(data)) {\r\n                dataItems = data;\r\n                totalRowCount = data.length;\r\n            }\r\n            else if (data.dataItems !== undefined && data.totalRowCount !== undefined) {\r\n                dataItems = data.dataItems;\r\n                totalRowCount = data.totalRowCount;\r\n            }\r\n            else {\r\n                throw Errors.queryResultTypeError();\r\n            }\r\n            this.selected.fire(this, { totalRowCount, dataItems });\r\n            return { totalRowCount, dataItems };\r\n        }).catch(exc => {\r\n            this.processError(exc, 'select');\r\n            throw exc;\r\n        });\r\n    }\r\n    processError(exc, method) {\r\n        exc.method = method;\r\n        this.error.fire(this, exc);\r\n        if (!exc.handled)\r\n            throw exc;\r\n    }\r\n}\r\nexport class DataSourceSelectArguments {\r\n    constructor() {\r\n        this.startRowIndex = 0;\r\n        this.maximumRows = 2147483647;\r\n    }\r\n}\r\nexport class ArrayDataSource extends DataSource {\r\n    constructor(items) {\r\n        super({\r\n            select(args) {\r\n                return __awaiter(this, void 0, void 0, function* () {\r\n                    if (args.sortExpression) {\r\n                    }\r\n                    let dataItems = items.slice(args.startRowIndex, args.startRowIndex + args.maximumRows);\r\n                    let result = { dataItems, totalRowCount: items.length };\r\n                    return result;\r\n                });\r\n            }\r\n        });\r\n    }\r\n}\r\n// }\r\n"],"file":"DataSource.js"}